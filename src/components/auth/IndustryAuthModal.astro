---
// TETRIX Industry Authentication Modal Component
// Provides industry-specific authentication with role-based access
---

<div id="industry-auth-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
  <div class="flex items-center justify-center min-h-screen p-4">
    <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
      <!-- Header -->
      <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4">
        <div class="flex items-center justify-between">
          <div>
            <h2 class="text-2xl font-bold text-gray-900">Industry Authentication</h2>
            <p class="text-gray-600 mt-1">Select your industry and authenticate to access your dashboard</p>
          </div>
          <button 
            id="close-industry-auth-modal" 
            class="text-gray-400 hover:text-gray-600 transition-colors"
            aria-label="Close modal"
          >
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
      </div>

      <!-- Content -->
      <div class="p-6">
        <!-- Industry Selection -->
        <div id="industry-selection" class="mb-8">
          <h3 class="text-lg font-semibold text-gray-900 mb-4">Select Your Industry</h3>
          <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
            <!-- Healthcare -->
            <button 
              class="industry-option p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all text-left"
              data-industry="healthcare"
            >
              <div class="text-2xl mb-2">🏥</div>
              <div class="font-medium text-gray-900">Healthcare</div>
              <div class="text-sm text-gray-600">Patient care & HIPAA compliance</div>
            </button>

            <!-- Legal -->
            <button 
              class="industry-option p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all text-left"
              data-industry="legal"
            >
              <div class="text-2xl mb-2">⚖️</div>
              <div class="font-medium text-gray-900">Legal</div>
              <div class="text-sm text-gray-600">Case management & attorney privilege</div>
            </button>

            <!-- Real Estate -->
            <button 
              class="industry-option p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all text-left"
              data-industry="real_estate"
            >
              <div class="text-2xl mb-2">🏠</div>
              <div class="font-medium text-gray-900">Real Estate</div>
              <div class="text-sm text-gray-600">MLS integration & property management</div>
            </button>

            <!-- E-commerce -->
            <button 
              class="industry-option p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all text-left"
              data-industry="ecommerce"
            >
              <div class="text-2xl mb-2">🛒</div>
              <div class="font-medium text-gray-900">E-commerce</div>
              <div class="text-sm text-gray-600">Shopify, Wix, WooCommerce</div>
            </button>

            <!-- Construction -->
            <button 
              class="industry-option p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all text-left"
              data-industry="construction"
            >
              <div class="text-2xl mb-2">🏗️</div>
              <div class="font-medium text-gray-900">Construction</div>
              <div class="text-sm text-gray-600">Project management & safety</div>
            </button>

            <!-- Logistics -->
            <button 
              class="industry-option p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all text-left"
              data-industry="logistics"
            >
              <div class="text-2xl mb-2">🚛</div>
              <div class="font-medium text-gray-900">Logistics</div>
              <div class="text-sm text-gray-600">Fleet management & tracking</div>
            </button>

            <!-- Government -->
            <button 
              class="industry-option p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all text-left"
              data-industry="government"
            >
              <div class="text-2xl mb-2">🏛️</div>
              <div class="font-medium text-gray-900">Government</div>
              <div class="text-sm text-gray-600">Citizen services & compliance</div>
            </button>

            <!-- Education -->
            <button 
              class="industry-option p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all text-left"
              data-industry="education"
            >
              <div class="text-2xl mb-2">🎓</div>
              <div class="font-medium text-gray-900">Education</div>
              <div class="text-sm text-gray-600">Student services & FERPA compliance</div>
            </button>

            <!-- Retail -->
            <button 
              class="industry-option p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all text-left"
              data-industry="retail"
            >
              <div class="text-2xl mb-2">🛍️</div>
              <div class="font-medium text-gray-900">Retail</div>
              <div class="text-sm text-gray-600">Customer service & inventory</div>
            </button>

            <!-- Hospitality -->
            <button 
              class="industry-option p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all text-left"
              data-industry="hospitality"
            >
              <div class="text-2xl mb-2">🏨</div>
              <div class="font-medium text-gray-900">Hospitality</div>
              <div class="text-sm text-gray-600">Guest services & reservations</div>
            </button>

            <!-- Wellness -->
            <button 
              class="industry-option p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all text-left"
              data-industry="wellness"
            >
              <div class="text-2xl mb-2">💪</div>
              <div class="font-medium text-gray-900">Wellness</div>
              <div class="text-sm text-gray-600">Health & fitness services</div>
            </button>

            <!-- Beauty -->
            <button 
              class="industry-option p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all text-left"
              data-industry="beauty"
            >
              <div class="text-2xl mb-2">💄</div>
              <div class="font-medium text-gray-900">Beauty</div>
              <div class="text-sm text-gray-600">Salon & spa services</div>
            </button>
          </div>
        </div>

        <!-- Authentication Form -->
        <div id="auth-form" class="hidden">
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-2">Authentication</h3>
            <p class="text-gray-600">Please authenticate to access your industry dashboard</p>
          </div>

          <!-- Authentication Methods -->
          <div class="space-y-4">
            <!-- Email/Password -->
            <div class="auth-method">
              <button 
                class="w-full p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all text-left"
                data-method="email"
              >
                <div class="flex items-center">
                  <div class="text-2xl mr-3">📧</div>
                  <div>
                    <div class="font-medium text-gray-900">Email & Password</div>
                    <div class="text-sm text-gray-600">Sign in with your email address</div>
                  </div>
                </div>
              </button>
            </div>

            <!-- SSO -->
            <div class="auth-method">
              <button 
                class="w-full p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all text-left"
                data-method="sso"
              >
                <div class="flex items-center">
                  <div class="text-2xl mr-3">🔐</div>
                  <div>
                    <div class="font-medium text-gray-900">Single Sign-On (SSO)</div>
                    <div class="text-sm text-gray-600">Use your organization's SSO</div>
                  </div>
                </div>
              </button>
            </div>

            <!-- Industry-specific integrations -->
            <div id="industry-integrations" class="hidden">
              <!-- Healthcare - Epic MyChart -->
              <div class="healthcare-integration hidden">
                <button 
                  class="w-full p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all text-left"
                  data-method="epic_mychart"
                >
                  <div class="flex items-center">
                    <div class="text-2xl mr-3">🏥</div>
                    <div>
                      <div class="font-medium text-gray-900">Epic MyChart</div>
                      <div class="text-sm text-gray-600">Connect with your Epic MyChart account</div>
                    </div>
                  </div>
                </button>
              </div>

              <!-- Legal - Clio -->
              <div class="legal-integration hidden">
                <button 
                  class="w-full p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all text-left"
                  data-method="clio"
                >
                  <div class="flex items-center">
                    <div class="text-2xl mr-3">⚖️</div>
                    <div>
                      <div class="font-medium text-gray-900">Clio</div>
                      <div class="text-sm text-gray-600">Connect with your Clio account</div>
                    </div>
                  </div>
                </button>
              </div>

              <!-- Real Estate - MLS -->
              <div class="real_estate-integration hidden">
                <button 
                  class="w-full p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all text-left"
                  data-method="mls"
                >
                  <div class="flex items-center">
                    <div class="text-2xl mr-3">🏠</div>
                    <div>
                      <div class="font-medium text-gray-900">MLS Integration</div>
                      <div class="text-sm text-gray-600">Connect with your MLS system</div>
                    </div>
                  </div>
                </button>
              </div>

              <!-- E-commerce - Shopify -->
              <div class="ecommerce-integration hidden">
                <button 
                  class="w-full p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all text-left"
                  data-method="shopify"
                >
                  <div class="flex items-center">
                    <div class="text-2xl mr-3">🛒</div>
                    <div>
                      <div class="font-medium text-gray-900">Shopify</div>
                      <div class="text-sm text-gray-600">Connect with your Shopify store</div>
                    </div>
                  </div>
                </button>
              </div>
            </div>
          </div>

          <!-- Email/Password Form -->
          <div id="email-form" class="hidden mt-6">
            <form class="space-y-4">
              <div>
                <label for="auth-email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                <input 
                  type="email" 
                  id="auth-email" 
                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  placeholder="Enter your email address"
                  required
                >
              </div>
              <div>
                <label for="auth-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                <input 
                  type="password" 
                  id="auth-password" 
                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  placeholder="Enter your password"
                  required
                >
              </div>
              <div class="flex items-center justify-between">
                <label class="flex items-center">
                  <input type="checkbox" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                  <span class="ml-2 text-sm text-gray-600">Remember me</span>
                </label>
                <a href="#" class="text-sm text-blue-600 hover:text-blue-500">Forgot password?</a>
              </div>
              <button 
                type="submit" 
                class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors"
              >
                Sign In
              </button>
            </form>
          </div>

          <!-- 2FA Form -->
          <div id="twofa-form" class="hidden mt-6">
            <div class="text-center mb-4">
              <div class="text-4xl mb-2">🔐</div>
              <h3 class="text-lg font-semibold text-gray-900">Two-Factor Authentication</h3>
              <p class="text-gray-600 mt-1">Enter the verification code from your authenticator app</p>
            </div>
            <form class="space-y-4">
              <div>
                <label for="twofa-code" class="block text-sm font-medium text-gray-700 mb-1">Verification Code</label>
                <input 
                  type="text" 
                  id="twofa-code" 
                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-center text-lg tracking-widest"
                  placeholder="000000"
                  maxlength="6"
                  required
                >
              </div>
              <button 
                type="submit" 
                class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors"
              >
                Verify Code
              </button>
              <div class="text-center">
                <button 
                  type="button" 
                  class="text-sm text-blue-600 hover:text-blue-500"
                  id="resend-code"
                >
                  Resend code
                </button>
              </div>
            </form>
          </div>

          <!-- Loading State -->
          <div id="auth-loading" class="hidden text-center py-8">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
            <p class="text-gray-600">Authenticating...</p>
          </div>

          <!-- Success State -->
          <div id="auth-success" class="hidden text-center py-8">
            <div class="text-4xl mb-4">✅</div>
            <h3 class="text-lg font-semibold text-gray-900 mb-2">Authentication Successful</h3>
            <p class="text-gray-600 mb-4">Redirecting to your dashboard...</p>
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-green-600 mx-auto"></div>
          </div>

          <!-- Error State -->
          <div id="auth-error" class="hidden text-center py-8">
            <div class="text-4xl mb-4">❌</div>
            <h3 class="text-lg font-semibold text-gray-900 mb-2">Authentication Failed</h3>
            <p class="text-gray-600 mb-4" id="error-message">Please try again</p>
            <button 
              id="retry-auth" 
              class="bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors"
            >
              Try Again
            </button>
          </div>
        </div>

        <!-- Back Button -->
        <div id="back-button" class="hidden mt-6">
          <button 
            id="back-to-industry-selection" 
            class="flex items-center text-gray-600 hover:text-gray-800 transition-colors"
          >
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
            Back to Industry Selection
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Industry Authentication Modal JavaScript
  class IndustryAuthModal {
    constructor() {
      this.modal = document.getElementById('industry-auth-modal');
      this.industrySelection = document.getElementById('industry-selection');
      this.authForm = document.getElementById('auth-form');
      this.industryIntegrations = document.getElementById('industry-integrations');
      this.emailForm = document.getElementById('email-form');
      this.twofaForm = document.getElementById('twofa-form');
      this.authLoading = document.getElementById('auth-loading');
      this.authSuccess = document.getElementById('auth-success');
      this.authError = document.getElementById('auth-error');
      this.backButton = document.getElementById('back-button');
      
      this.selectedIndustry = null;
      this.selectedMethod = null;
      
      this.init();
    }

    init() {
      this.bindEvents();
    }

    bindEvents() {
      // Close modal
      document.getElementById('close-industry-auth-modal')?.addEventListener('click', () => {
        this.closeModal();
      });

      // Industry selection
      document.querySelectorAll('.industry-option').forEach(option => {
        option.addEventListener('click', (e) => {
          this.selectIndustry(e.currentTarget.dataset.industry);
        });
      });

      // Authentication methods
      document.querySelectorAll('.auth-method button').forEach(button => {
        button.addEventListener('click', (e) => {
          this.selectAuthMethod(e.currentTarget.dataset.method);
        });
      });

      // Industry integrations
      document.querySelectorAll('#industry-integrations button').forEach(button => {
        button.addEventListener('click', (e) => {
          this.selectAuthMethod(e.currentTarget.dataset.method);
        });
      });

      // Back button
      document.getElementById('back-to-industry-selection')?.addEventListener('click', () => {
        this.showIndustrySelection();
      });

      // Form submissions
      document.getElementById('email-form')?.addEventListener('submit', (e) => {
        e.preventDefault();
        this.handleEmailAuth();
      });

      document.getElementById('twofa-form')?.addEventListener('submit', (e) => {
        e.preventDefault();
        this.handleTwoFA();
      });

      // Retry button
      document.getElementById('retry-auth')?.addEventListener('click', () => {
        this.showAuthForm();
      });

      // Resend code
      document.getElementById('resend-code')?.addEventListener('click', () => {
        this.resendCode();
      });

      // Close on backdrop click
      this.modal?.addEventListener('click', (e) => {
        if (e.target === this.modal) {
          this.closeModal();
        }
      });
    }

    selectIndustry(industry) {
      this.selectedIndustry = industry;
      
      // Update UI
      document.querySelectorAll('.industry-option').forEach(option => {
        option.classList.remove('border-blue-500', 'bg-blue-50');
        option.classList.add('border-gray-200');
      });
      
      document.querySelector(`[data-industry="${industry}"]`).classList.add('border-blue-500', 'bg-blue-50');
      document.querySelector(`[data-industry="${industry}"]`).classList.remove('border-gray-200');

      // Show auth form
      this.showAuthForm();
    }

    showAuthForm() {
      this.industrySelection.classList.add('hidden');
      this.authForm.classList.remove('hidden');
      this.backButton.classList.remove('hidden');

      // Show industry-specific integrations
      this.showIndustryIntegrations();
    }

    showIndustryIntegrations() {
      // Hide all integrations
      document.querySelectorAll('#industry-integrations > div').forEach(div => {
        div.classList.add('hidden');
      });

      // Show relevant integration
      const integration = document.querySelector(`.${this.selectedIndustry}-integration`);
      if (integration) {
        integration.classList.remove('hidden');
        this.industryIntegrations.classList.remove('hidden');
      } else {
        this.industryIntegrations.classList.add('hidden');
      }
    }

    selectAuthMethod(method) {
      this.selectedMethod = method;
      
      // Update UI
      document.querySelectorAll('.auth-method button').forEach(button => {
        button.classList.remove('border-blue-500', 'bg-blue-50');
        button.classList.add('border-gray-200');
      });
      
      document.querySelectorAll('#industry-integrations button').forEach(button => {
        button.classList.remove('border-blue-500', 'bg-blue-50');
        button.classList.add('border-gray-200');
      });

      const selectedButton = document.querySelector(`[data-method="${method}"]`);
      if (selectedButton) {
        selectedButton.classList.add('border-blue-500', 'bg-blue-50');
        selectedButton.classList.remove('border-gray-200');
      }

      // Show appropriate form
      this.showAuthMethodForm(method);
    }

    showAuthMethodForm(method) {
      // Hide all forms
      this.emailForm.classList.add('hidden');
      this.twofaForm.classList.add('hidden');
      this.authLoading.classList.add('hidden');
      this.authSuccess.classList.add('hidden');
      this.authError.classList.add('hidden');

      // Show appropriate form
      switch (method) {
        case 'email':
          this.emailForm.classList.remove('hidden');
          break;
        case 'sso':
          this.handleSSO();
          break;
        case 'epic_mychart':
          this.handleEpicMyChart();
          break;
        case 'clio':
          this.handleClio();
          break;
        case 'mls':
          this.handleMLS();
          break;
        case 'shopify':
          this.handleShopify();
          break;
        default:
          this.handleGenericAuth();
      }
    }

    handleEmailAuth() {
      const email = document.getElementById('auth-email').value;
      const password = document.getElementById('auth-password').value;

      if (!email || !password) {
        this.showError('Please enter both email and password');
        return;
      }

      this.showLoading();
      
      // Simulate authentication
      setTimeout(() => {
        this.handleAuthResponse({ success: true, requires2FA: true });
      }, 2000);
    }

    handleTwoFA() {
      const code = document.getElementById('twofa-code').value;

      if (!code || code.length !== 6) {
        this.showError('Please enter a valid 6-digit code');
        return;
      }

      this.showLoading();
      
      // Simulate 2FA verification
      setTimeout(() => {
        this.handleAuthResponse({ success: true, requires2FA: false });
      }, 1500);
    }

    handleSSO() {
      this.showLoading();
      
      // Simulate SSO redirect
      setTimeout(() => {
        this.handleAuthResponse({ success: true, requires2FA: false });
      }, 3000);
    }

    handleEpicMyChart() {
      this.showLoading();
      
      // Simulate Epic MyChart OAuth
      setTimeout(() => {
        this.handleAuthResponse({ success: true, requires2FA: false });
      }, 2500);
    }

    handleClio() {
      this.showLoading();
      
      // Simulate Clio integration
      setTimeout(() => {
        this.handleAuthResponse({ success: true, requires2FA: false });
      }, 2500);
    }

    handleMLS() {
      this.showLoading();
      
      // Simulate MLS integration
      setTimeout(() => {
        this.handleAuthResponse({ success: true, requires2FA: false });
      }, 2500);
    }

    handleShopify() {
      this.showLoading();
      
      // Simulate Shopify integration
      setTimeout(() => {
        this.handleAuthResponse({ success: true, requires2FA: false });
      }, 2500);
    }

    handleGenericAuth() {
      this.showLoading();
      
      // Simulate generic authentication
      setTimeout(() => {
        this.handleAuthResponse({ success: true, requires2FA: false });
      }, 2000);
    }

    handleAuthResponse(response) {
      if (response.success) {
        if (response.requires2FA) {
          this.showTwoFA();
        } else {
          this.showSuccess();
          // Redirect to dashboard after success
          setTimeout(() => {
            this.redirectToDashboard();
          }, 2000);
        }
      } else {
        this.showError(response.message || 'Authentication failed');
      }
    }

    showLoading() {
      this.emailForm.classList.add('hidden');
      this.twofaForm.classList.add('hidden');
      this.authLoading.classList.remove('hidden');
      this.authSuccess.classList.add('hidden');
      this.authError.classList.add('hidden');
    }

    showTwoFA() {
      this.emailForm.classList.add('hidden');
      this.twofaForm.classList.remove('hidden');
      this.authLoading.classList.add('hidden');
      this.authSuccess.classList.add('hidden');
      this.authError.classList.add('hidden');
    }

    showSuccess() {
      this.emailForm.classList.add('hidden');
      this.twofaForm.classList.add('hidden');
      this.authLoading.classList.add('hidden');
      this.authSuccess.classList.remove('hidden');
      this.authError.classList.add('hidden');
    }

    showError(message) {
      this.emailForm.classList.add('hidden');
      this.twofaForm.classList.add('hidden');
      this.authLoading.classList.add('hidden');
      this.authSuccess.classList.add('hidden');
      this.authError.classList.remove('hidden');
      
      document.getElementById('error-message').textContent = message;
    }

    showIndustrySelection() {
      this.industrySelection.classList.remove('hidden');
      this.authForm.classList.add('hidden');
      this.backButton.classList.add('hidden');
      
      // Reset selections
      this.selectedIndustry = null;
      this.selectedMethod = null;
    }

    resendCode() {
      // Simulate resending code
      console.log('Resending 2FA code...');
    }

    redirectToDashboard() {
      // Redirect to industry-specific dashboard
      const dashboardUrl = `/dashboards/${this.selectedIndustry}`;
      window.location.href = dashboardUrl;
    }

    closeModal() {
      this.modal.classList.add('hidden');
      this.showIndustrySelection();
    }

    open() {
      this.modal.classList.remove('hidden');
      this.showIndustrySelection();
    }
  }

  // Initialize modal when DOM is loaded
  document.addEventListener('DOMContentLoaded', () => {
    window.industryAuthModal = new IndustryAuthModal();
  });

  // Global function to open modal
  window.openIndustryAuth = () => {
    window.industryAuthModal?.open();
  };
</script>
