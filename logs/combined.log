{"level":"info","message":"Evaluating policies for tenant test_tenant, step: initiated","service":"tetrix-voice-api","timestamp":"2025-10-07T23:41:28.328Z"}
{"level":"warn","message":"No active policies found for tenant test_tenant","service":"tetrix-voice-api","timestamp":"2025-10-07T23:41:28.330Z"}
{"level":"info","message":"Evaluating policies for tenant test_tenant, step: initiated","service":"tetrix-voice-api","timestamp":"2025-10-07T23:41:28.334Z"}
{"level":"error","message":"Error logging policy evaluation: _crypto.default.randomFillSync is not a function","service":"tetrix-voice-api","stack":"TypeError: _crypto.default.randomFillSync is not a function\n    at rng (/home/diegomartinez/Desktop/tetrix/services/voice-api/node_modules/uuid/dist/rng.js:18:21)\n    at v4 (/home/diegomartinez/Desktop/tetrix/services/voice-api/node_modules/uuid/dist/v4.js:23:63)\n    at PolicyEngineService.logPolicyEvaluation (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/PolicyEngineService.ts:647:19)\n    at PolicyEngineService.evaluatePolicy (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/PolicyEngineService.ts:87:18)\n    at Object.<anonymous> (/home/diegomartinez/Desktop/tetrix/tests/compliance-mock.test.ts:248:22)","timestamp":"2025-10-07T23:41:28.348Z"}
{"level":"info","message":"Policy evaluation complete for tenant test_tenant: continue","service":"tetrix-voice-api","timestamp":"2025-10-07T23:41:28.348Z"}
{"level":"info","message":"Evaluating policies for tenant non_existent_tenant, step: initiated","service":"tetrix-voice-api","timestamp":"2025-10-07T23:41:28.352Z"}
{"level":"error","message":"Error evaluating policies for tenant non_existent_tenant: Tenant not found: non_existent_tenant","service":"tetrix-voice-api","stack":"Error: Tenant not found: non_existent_tenant\n    at PolicyEngineService.evaluatePolicy (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/PolicyEngineService.ts:70:15)\n    at Object.<anonymous> (/home/diegomartinez/Desktop/tetrix/tests/compliance-mock.test.ts:281:7)","timestamp":"2025-10-07T23:41:28.353Z"}
{"level":"error","message":"Error logging audit event: _crypto.default.randomFillSync is not a function","service":"tetrix-voice-api","stack":"TypeError: _crypto.default.randomFillSync is not a function\n    at rng (/home/diegomartinez/Desktop/tetrix/services/voice-api/node_modules/uuid/dist/rng.js:18:21)\n    at v4 (/home/diegomartinez/Desktop/tetrix/services/voice-api/node_modules/uuid/dist/v4.js:23:63)\n    at AuditEvidenceService.logEvent (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/AuditEvidenceService.ts:72:41)\n    at Object.<anonymous> (/home/diegomartinez/Desktop/tetrix/tests/compliance-mock.test.ts:318:46)\n    at Promise.then.completed (/home/diegomartinez/Desktop/tetrix/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/diegomartinez/Desktop/tetrix/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/diegomartinez/Desktop/tetrix/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/home/diegomartinez/Desktop/tetrix/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/diegomartinez/Desktop/tetrix/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/diegomartinez/Desktop/tetrix/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/diegomartinez/Desktop/tetrix/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/diegomartinez/Desktop/tetrix/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/diegomartinez/Desktop/tetrix/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/diegomartinez/Desktop/tetrix/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/diegomartinez/Desktop/tetrix/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/diegomartinez/Desktop/tetrix/node_modules/jest-runner/build/runTest.js:444:34)","timestamp":"2025-10-07T23:41:28.358Z"}
{"level":"info","message":"Starting text redaction for tenant test_tenant, call test_call","service":"tetrix-voice-api","timestamp":"2025-10-07T23:41:28.362Z"}
{"level":"error","message":"Error getting redaction rules for tenant test_tenant: Cannot read properties of undefined (reading 'findMany')","service":"tetrix-voice-api","stack":"TypeError: Cannot read properties of undefined (reading 'findMany')\n    at ComplianceDatabaseService.getRedactionRules (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/models/complianceModels.ts:826:44)\n    at RedactionDLPService.getRedactionRules (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/RedactionDLPService.ts:174:48)\n    at RedactionDLPService.redactText (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/RedactionDLPService.ts:78:32)\n    at Object.<anonymous> (/home/diegomartinez/Desktop/tetrix/tests/compliance-mock.test.ts:403:45)\n    at Promise.then.completed (/home/diegomartinez/Desktop/tetrix/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/diegomartinez/Desktop/tetrix/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/diegomartinez/Desktop/tetrix/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/home/diegomartinez/Desktop/tetrix/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/diegomartinez/Desktop/tetrix/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/diegomartinez/Desktop/tetrix/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/diegomartinez/Desktop/tetrix/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/diegomartinez/Desktop/tetrix/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/diegomartinez/Desktop/tetrix/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/diegomartinez/Desktop/tetrix/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/diegomartinez/Desktop/tetrix/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/diegomartinez/Desktop/tetrix/node_modules/jest-runner/build/runTest.js:444:34)","timestamp":"2025-10-07T23:41:28.366Z"}
{"level":"error","message":"Error getting default redaction rules: Cannot read properties of undefined (reading 'findMany')","service":"tetrix-voice-api","stack":"TypeError: Cannot read properties of undefined (reading 'findMany')\n    at RedactionDLPService.getDefaultRules (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/RedactionDLPService.ts:433:60)\n    at RedactionDLPService.getRedactionRules (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/RedactionDLPService.ts:192:19)\n    at RedactionDLPService.redactText (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/RedactionDLPService.ts:78:21)\n    at Object.<anonymous> (/home/diegomartinez/Desktop/tetrix/tests/compliance-mock.test.ts:403:22)","timestamp":"2025-10-07T23:41:28.366Z"}
{"level":"error","message":"Error logging redaction activity: _crypto.default.randomFillSync is not a function","service":"tetrix-voice-api","stack":"TypeError: _crypto.default.randomFillSync is not a function\n    at rng (/home/diegomartinez/Desktop/tetrix/services/voice-api/node_modules/uuid/dist/rng.js:18:21)\n    at v4 (/home/diegomartinez/Desktop/tetrix/services/voice-api/node_modules/uuid/dist/v4.js:23:63)\n    at RedactionDLPService.logRedaction (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/RedactionDLPService.ts:552:19)\n    at RedactionDLPService.redactText (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/RedactionDLPService.ts:84:39)\n    at Object.<anonymous> (/home/diegomartinez/Desktop/tetrix/tests/compliance-mock.test.ts:403:22)","timestamp":"2025-10-07T23:41:28.367Z"}
{"level":"error","message":"Error redacting text for call test_call: _crypto.default.randomFillSync is not a function","service":"tetrix-voice-api","stack":"TypeError: _crypto.default.randomFillSync is not a function\n    at rng (/home/diegomartinez/Desktop/tetrix/services/voice-api/node_modules/uuid/dist/rng.js:18:21)\n    at v4 (/home/diegomartinez/Desktop/tetrix/services/voice-api/node_modules/uuid/dist/v4.js:23:63)\n    at RedactionDLPService.logRedaction (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/RedactionDLPService.ts:552:19)\n    at RedactionDLPService.redactText (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/RedactionDLPService.ts:84:39)\n    at Object.<anonymous> (/home/diegomartinez/Desktop/tetrix/tests/compliance-mock.test.ts:403:22)","timestamp":"2025-10-07T23:41:28.367Z"}
{"level":"info","message":"Recording consent for customer test_customer, type: call_recording","service":"tetrix-voice-api","timestamp":"2025-10-07T23:41:28.369Z"}
{"level":"error","message":"Error getting active consent for customer test_customer: this.prisma.consentLedger.findFirst is not a function","service":"tetrix-voice-api","stack":"TypeError: this.prisma.consentLedger.findFirst is not a function\n    at ConsentManagementService.getActiveConsent (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/ConsentManagementService.ts:497:55)\n    at ConsentManagementService.validateConsentRequest (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/ConsentManagementService.ts:430:29)\n    at ConsentManagementService.recordConsent (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/ConsentManagementService.ts:82:26)\n    at Object.<anonymous> (/home/diegomartinez/Desktop/tetrix/tests/compliance-mock.test.ts:490:31)","timestamp":"2025-10-07T23:41:28.372Z"}
{"level":"error","message":"Error getting active consent for customer test_customer: this.prisma.consentLedger.findFirst is not a function","service":"tetrix-voice-api","stack":"TypeError: this.prisma.consentLedger.findFirst is not a function\n    at ConsentManagementService.getActiveConsent (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/ConsentManagementService.ts:497:55)\n    at ConsentManagementService.recordConsent (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/ConsentManagementService.ts:88:31)\n    at Object.<anonymous> (/home/diegomartinez/Desktop/tetrix/tests/compliance-mock.test.ts:490:31)","timestamp":"2025-10-07T23:41:28.372Z"}
{"level":"error","message":"Error recording consent for customer test_customer: Cannot read properties of undefined (reading 'update')","service":"tetrix-voice-api","stack":"TypeError: Cannot read properties of undefined (reading 'update')\n    at ConsentManagementService.createConsentHash (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/ConsentManagementService.ts:428:13)\n    at ConsentManagementService.recordConsent (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/ConsentManagementService.ts:91:34)\n    at Object.<anonymous> (/home/diegomartinez/Desktop/tetrix/tests/compliance-mock.test.ts:490:31)","timestamp":"2025-10-07T23:41:28.372Z"}
{"level":"error","message":"Error getting active consent for customer test_customer: this.prisma.consentLedger.findFirst is not a function","service":"tetrix-voice-api","stack":"TypeError: this.prisma.consentLedger.findFirst is not a function\n    at ConsentManagementService.getActiveConsent (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/ConsentManagementService.ts:497:55)\n    at ConsentManagementService.checkConsent (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/ConsentManagementService.ts:147:29)\n    at Object.<anonymous> (/home/diegomartinez/Desktop/tetrix/tests/compliance-mock.test.ts:531:29)","timestamp":"2025-10-07T23:41:28.374Z"}
{"level":"info","message":"Withdrawing consent for customer test_customer, type: marketing","service":"tetrix-voice-api","timestamp":"2025-10-07T23:41:28.375Z"}
{"level":"error","message":"Error getting active consent for customer test_customer: this.prisma.consentLedger.findFirst is not a function","service":"tetrix-voice-api","stack":"TypeError: this.prisma.consentLedger.findFirst is not a function\n    at ConsentManagementService.getActiveConsent (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/ConsentManagementService.ts:497:55)\n    at ConsentManagementService.withdrawConsent (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/ConsentManagementService.ts:179:29)\n    at Object.<anonymous> (/home/diegomartinez/Desktop/tetrix/tests/compliance-mock.test.ts:574:22)","timestamp":"2025-10-07T23:41:28.375Z"}
{"level":"warn","message":"No active consent found for customer test_customer, type: marketing","service":"tetrix-voice-api","timestamp":"2025-10-07T23:41:28.376Z"}
{"level":"info","message":"Evaluating policies for tenant test_tenant, step: initiated","service":"tetrix-voice-api","timestamp":"2025-10-07T23:41:28.377Z"}
{"level":"error","message":"Error logging policy evaluation: _crypto.default.randomFillSync is not a function","service":"tetrix-voice-api","stack":"TypeError: _crypto.default.randomFillSync is not a function\n    at rng (/home/diegomartinez/Desktop/tetrix/services/voice-api/node_modules/uuid/dist/rng.js:18:21)\n    at v4 (/home/diegomartinez/Desktop/tetrix/services/voice-api/node_modules/uuid/dist/v4.js:23:63)\n    at PolicyEngineService.logPolicyEvaluation (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/PolicyEngineService.ts:647:19)\n    at PolicyEngineService.evaluatePolicy (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/PolicyEngineService.ts:87:18)\n    at Object.<anonymous> (/home/diegomartinez/Desktop/tetrix/tests/compliance-mock.test.ts:679:28)","timestamp":"2025-10-07T23:41:28.377Z"}
{"level":"info","message":"Policy evaluation complete for tenant test_tenant: continue","service":"tetrix-voice-api","timestamp":"2025-10-07T23:41:28.377Z"}
{"level":"error","message":"Error logging audit event: _crypto.default.randomFillSync is not a function","service":"tetrix-voice-api","stack":"TypeError: _crypto.default.randomFillSync is not a function\n    at rng (/home/diegomartinez/Desktop/tetrix/services/voice-api/node_modules/uuid/dist/rng.js:18:21)\n    at v4 (/home/diegomartinez/Desktop/tetrix/services/voice-api/node_modules/uuid/dist/v4.js:23:63)\n    at AuditEvidenceService.logEvent (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/AuditEvidenceService.ts:72:41)\n    at Object.<anonymous> (/home/diegomartinez/Desktop/tetrix/tests/compliance-mock.test.ts:692:46)","timestamp":"2025-10-07T23:41:28.377Z"}
{"level":"info","message":"Evaluating policies for tenant test_tenant, step: initiated","service":"tetrix-voice-api","timestamp":"2025-10-08T19:34:42.923Z"}
{"level":"warn","message":"No active policies found for tenant test_tenant","service":"tetrix-voice-api","timestamp":"2025-10-08T19:34:42.925Z"}
{"level":"info","message":"Evaluating policies for tenant test_tenant, step: initiated","service":"tetrix-voice-api","timestamp":"2025-10-08T19:34:42.927Z"}
{"level":"error","message":"Error logging policy evaluation: _crypto.default.randomFillSync is not a function","service":"tetrix-voice-api","stack":"TypeError: _crypto.default.randomFillSync is not a function\n    at rng (/home/diegomartinez/Desktop/tetrix/services/voice-api/node_modules/uuid/dist/rng.js:18:21)\n    at v4 (/home/diegomartinez/Desktop/tetrix/services/voice-api/node_modules/uuid/dist/v4.js:23:63)\n    at PolicyEngineService.logPolicyEvaluation (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/PolicyEngineService.ts:647:19)\n    at PolicyEngineService.evaluatePolicy (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/PolicyEngineService.ts:87:18)\n    at Object.<anonymous> (/home/diegomartinez/Desktop/tetrix/tests/compliance-mock.test.ts:248:22)","timestamp":"2025-10-08T19:34:42.937Z"}
{"level":"info","message":"Policy evaluation complete for tenant test_tenant: continue","service":"tetrix-voice-api","timestamp":"2025-10-08T19:34:42.938Z"}
{"level":"info","message":"Evaluating policies for tenant non_existent_tenant, step: initiated","service":"tetrix-voice-api","timestamp":"2025-10-08T19:34:42.942Z"}
{"level":"error","message":"Error evaluating policies for tenant non_existent_tenant: Tenant not found: non_existent_tenant","service":"tetrix-voice-api","stack":"Error: Tenant not found: non_existent_tenant\n    at PolicyEngineService.evaluatePolicy (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/PolicyEngineService.ts:70:15)\n    at Object.<anonymous> (/home/diegomartinez/Desktop/tetrix/tests/compliance-mock.test.ts:281:7)","timestamp":"2025-10-08T19:34:42.943Z"}
{"level":"error","message":"Error logging audit event: _crypto.default.randomFillSync is not a function","service":"tetrix-voice-api","stack":"TypeError: _crypto.default.randomFillSync is not a function\n    at rng (/home/diegomartinez/Desktop/tetrix/services/voice-api/node_modules/uuid/dist/rng.js:18:21)\n    at v4 (/home/diegomartinez/Desktop/tetrix/services/voice-api/node_modules/uuid/dist/v4.js:23:63)\n    at AuditEvidenceService.logEvent (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/AuditEvidenceService.ts:72:41)\n    at Object.<anonymous> (/home/diegomartinez/Desktop/tetrix/tests/compliance-mock.test.ts:318:46)\n    at Promise.then.completed (/home/diegomartinez/Desktop/tetrix/node_modules/.pnpm/jest-circus@29.7.0_babel-plugin-macros@3.1.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/diegomartinez/Desktop/tetrix/node_modules/.pnpm/jest-circus@29.7.0_babel-plugin-macros@3.1.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/diegomartinez/Desktop/tetrix/node_modules/.pnpm/jest-circus@29.7.0_babel-plugin-macros@3.1.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/home/diegomartinez/Desktop/tetrix/node_modules/.pnpm/jest-circus@29.7.0_babel-plugin-macros@3.1.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/diegomartinez/Desktop/tetrix/node_modules/.pnpm/jest-circus@29.7.0_babel-plugin-macros@3.1.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/diegomartinez/Desktop/tetrix/node_modules/.pnpm/jest-circus@29.7.0_babel-plugin-macros@3.1.0/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/diegomartinez/Desktop/tetrix/node_modules/.pnpm/jest-circus@29.7.0_babel-plugin-macros@3.1.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/diegomartinez/Desktop/tetrix/node_modules/.pnpm/jest-circus@29.7.0_babel-plugin-macros@3.1.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/diegomartinez/Desktop/tetrix/node_modules/.pnpm/jest-circus@29.7.0_babel-plugin-macros@3.1.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/diegomartinez/Desktop/tetrix/node_modules/.pnpm/jest-circus@29.7.0_babel-plugin-macros@3.1.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/diegomartinez/Desktop/tetrix/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/diegomartinez/Desktop/tetrix/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)","timestamp":"2025-10-08T19:34:42.946Z"}
{"level":"info","message":"Starting text redaction for tenant test_tenant, call test_call","service":"tetrix-voice-api","timestamp":"2025-10-08T19:34:42.950Z"}
{"level":"error","message":"Error getting redaction rules for tenant test_tenant: Cannot read properties of undefined (reading 'findMany')","service":"tetrix-voice-api","stack":"TypeError: Cannot read properties of undefined (reading 'findMany')\n    at ComplianceDatabaseService.getRedactionRules (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/models/complianceModels.ts:826:44)\n    at RedactionDLPService.getRedactionRules (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/RedactionDLPService.ts:174:48)\n    at RedactionDLPService.redactText (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/RedactionDLPService.ts:78:32)\n    at Object.<anonymous> (/home/diegomartinez/Desktop/tetrix/tests/compliance-mock.test.ts:403:45)\n    at Promise.then.completed (/home/diegomartinez/Desktop/tetrix/node_modules/.pnpm/jest-circus@29.7.0_babel-plugin-macros@3.1.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/diegomartinez/Desktop/tetrix/node_modules/.pnpm/jest-circus@29.7.0_babel-plugin-macros@3.1.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/diegomartinez/Desktop/tetrix/node_modules/.pnpm/jest-circus@29.7.0_babel-plugin-macros@3.1.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/home/diegomartinez/Desktop/tetrix/node_modules/.pnpm/jest-circus@29.7.0_babel-plugin-macros@3.1.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/diegomartinez/Desktop/tetrix/node_modules/.pnpm/jest-circus@29.7.0_babel-plugin-macros@3.1.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/diegomartinez/Desktop/tetrix/node_modules/.pnpm/jest-circus@29.7.0_babel-plugin-macros@3.1.0/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/diegomartinez/Desktop/tetrix/node_modules/.pnpm/jest-circus@29.7.0_babel-plugin-macros@3.1.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/diegomartinez/Desktop/tetrix/node_modules/.pnpm/jest-circus@29.7.0_babel-plugin-macros@3.1.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/diegomartinez/Desktop/tetrix/node_modules/.pnpm/jest-circus@29.7.0_babel-plugin-macros@3.1.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/diegomartinez/Desktop/tetrix/node_modules/.pnpm/jest-circus@29.7.0_babel-plugin-macros@3.1.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/diegomartinez/Desktop/tetrix/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/diegomartinez/Desktop/tetrix/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)","timestamp":"2025-10-08T19:34:42.954Z"}
{"level":"error","message":"Error getting default redaction rules: Cannot read properties of undefined (reading 'findMany')","service":"tetrix-voice-api","stack":"TypeError: Cannot read properties of undefined (reading 'findMany')\n    at RedactionDLPService.getDefaultRules (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/RedactionDLPService.ts:433:60)\n    at RedactionDLPService.getRedactionRules (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/RedactionDLPService.ts:192:19)\n    at RedactionDLPService.redactText (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/RedactionDLPService.ts:78:21)\n    at Object.<anonymous> (/home/diegomartinez/Desktop/tetrix/tests/compliance-mock.test.ts:403:22)","timestamp":"2025-10-08T19:34:42.955Z"}
{"level":"error","message":"Error logging redaction activity: _crypto.default.randomFillSync is not a function","service":"tetrix-voice-api","stack":"TypeError: _crypto.default.randomFillSync is not a function\n    at rng (/home/diegomartinez/Desktop/tetrix/services/voice-api/node_modules/uuid/dist/rng.js:18:21)\n    at v4 (/home/diegomartinez/Desktop/tetrix/services/voice-api/node_modules/uuid/dist/v4.js:23:63)\n    at RedactionDLPService.logRedaction (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/RedactionDLPService.ts:552:19)\n    at RedactionDLPService.redactText (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/RedactionDLPService.ts:84:39)\n    at Object.<anonymous> (/home/diegomartinez/Desktop/tetrix/tests/compliance-mock.test.ts:403:22)","timestamp":"2025-10-08T19:34:42.955Z"}
{"level":"error","message":"Error redacting text for call test_call: _crypto.default.randomFillSync is not a function","service":"tetrix-voice-api","stack":"TypeError: _crypto.default.randomFillSync is not a function\n    at rng (/home/diegomartinez/Desktop/tetrix/services/voice-api/node_modules/uuid/dist/rng.js:18:21)\n    at v4 (/home/diegomartinez/Desktop/tetrix/services/voice-api/node_modules/uuid/dist/v4.js:23:63)\n    at RedactionDLPService.logRedaction (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/RedactionDLPService.ts:552:19)\n    at RedactionDLPService.redactText (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/RedactionDLPService.ts:84:39)\n    at Object.<anonymous> (/home/diegomartinez/Desktop/tetrix/tests/compliance-mock.test.ts:403:22)","timestamp":"2025-10-08T19:34:42.956Z"}
{"level":"info","message":"Recording consent for customer test_customer, type: call_recording","service":"tetrix-voice-api","timestamp":"2025-10-08T19:34:42.957Z"}
{"level":"error","message":"Error getting active consent for customer test_customer: this.prisma.consentLedger.findFirst is not a function","service":"tetrix-voice-api","stack":"TypeError: this.prisma.consentLedger.findFirst is not a function\n    at ConsentManagementService.getActiveConsent (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/ConsentManagementService.ts:497:55)\n    at ConsentManagementService.validateConsentRequest (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/ConsentManagementService.ts:430:29)\n    at ConsentManagementService.recordConsent (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/ConsentManagementService.ts:82:26)\n    at Object.<anonymous> (/home/diegomartinez/Desktop/tetrix/tests/compliance-mock.test.ts:490:31)","timestamp":"2025-10-08T19:34:42.959Z"}
{"level":"error","message":"Error getting active consent for customer test_customer: this.prisma.consentLedger.findFirst is not a function","service":"tetrix-voice-api","stack":"TypeError: this.prisma.consentLedger.findFirst is not a function\n    at ConsentManagementService.getActiveConsent (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/ConsentManagementService.ts:497:55)\n    at ConsentManagementService.recordConsent (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/ConsentManagementService.ts:88:31)\n    at Object.<anonymous> (/home/diegomartinez/Desktop/tetrix/tests/compliance-mock.test.ts:490:31)","timestamp":"2025-10-08T19:34:42.960Z"}
{"level":"error","message":"Error recording consent for customer test_customer: Cannot read properties of undefined (reading 'update')","service":"tetrix-voice-api","stack":"TypeError: Cannot read properties of undefined (reading 'update')\n    at ConsentManagementService.createConsentHash (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/ConsentManagementService.ts:428:13)\n    at ConsentManagementService.recordConsent (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/ConsentManagementService.ts:91:34)\n    at Object.<anonymous> (/home/diegomartinez/Desktop/tetrix/tests/compliance-mock.test.ts:490:31)","timestamp":"2025-10-08T19:34:42.960Z"}
{"level":"error","message":"Error getting active consent for customer test_customer: this.prisma.consentLedger.findFirst is not a function","service":"tetrix-voice-api","stack":"TypeError: this.prisma.consentLedger.findFirst is not a function\n    at ConsentManagementService.getActiveConsent (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/ConsentManagementService.ts:497:55)\n    at ConsentManagementService.checkConsent (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/ConsentManagementService.ts:147:29)\n    at Object.<anonymous> (/home/diegomartinez/Desktop/tetrix/tests/compliance-mock.test.ts:531:29)","timestamp":"2025-10-08T19:34:42.961Z"}
{"level":"info","message":"Withdrawing consent for customer test_customer, type: marketing","service":"tetrix-voice-api","timestamp":"2025-10-08T19:34:42.962Z"}
{"level":"error","message":"Error getting active consent for customer test_customer: this.prisma.consentLedger.findFirst is not a function","service":"tetrix-voice-api","stack":"TypeError: this.prisma.consentLedger.findFirst is not a function\n    at ConsentManagementService.getActiveConsent (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/ConsentManagementService.ts:497:55)\n    at ConsentManagementService.withdrawConsent (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/ConsentManagementService.ts:179:29)\n    at Object.<anonymous> (/home/diegomartinez/Desktop/tetrix/tests/compliance-mock.test.ts:574:22)","timestamp":"2025-10-08T19:34:42.962Z"}
{"level":"warn","message":"No active consent found for customer test_customer, type: marketing","service":"tetrix-voice-api","timestamp":"2025-10-08T19:34:42.963Z"}
{"level":"info","message":"Evaluating policies for tenant test_tenant, step: initiated","service":"tetrix-voice-api","timestamp":"2025-10-08T19:34:42.964Z"}
{"level":"error","message":"Error logging policy evaluation: _crypto.default.randomFillSync is not a function","service":"tetrix-voice-api","stack":"TypeError: _crypto.default.randomFillSync is not a function\n    at rng (/home/diegomartinez/Desktop/tetrix/services/voice-api/node_modules/uuid/dist/rng.js:18:21)\n    at v4 (/home/diegomartinez/Desktop/tetrix/services/voice-api/node_modules/uuid/dist/v4.js:23:63)\n    at PolicyEngineService.logPolicyEvaluation (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/PolicyEngineService.ts:647:19)\n    at PolicyEngineService.evaluatePolicy (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/PolicyEngineService.ts:87:18)\n    at Object.<anonymous> (/home/diegomartinez/Desktop/tetrix/tests/compliance-mock.test.ts:679:28)","timestamp":"2025-10-08T19:34:42.964Z"}
{"level":"info","message":"Policy evaluation complete for tenant test_tenant: continue","service":"tetrix-voice-api","timestamp":"2025-10-08T19:34:42.964Z"}
{"level":"error","message":"Error logging audit event: _crypto.default.randomFillSync is not a function","service":"tetrix-voice-api","stack":"TypeError: _crypto.default.randomFillSync is not a function\n    at rng (/home/diegomartinez/Desktop/tetrix/services/voice-api/node_modules/uuid/dist/rng.js:18:21)\n    at v4 (/home/diegomartinez/Desktop/tetrix/services/voice-api/node_modules/uuid/dist/v4.js:23:63)\n    at AuditEvidenceService.logEvent (/home/diegomartinez/Desktop/tetrix/services/voice-api/src/services/AuditEvidenceService.ts:72:41)\n    at Object.<anonymous> (/home/diegomartinez/Desktop/tetrix/tests/compliance-mock.test.ts:692:46)","timestamp":"2025-10-08T19:34:42.964Z"}
